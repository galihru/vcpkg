vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO galihru/malware-detector
    REF auto-release-104
    SHA512 c7ba059206f06caebf4599062c54ccda916c999895000e943ec1bc0f1a8e18e43f4cb82e307bbe77306d998f41474c382f73983f5e2e88fd3881d6b30dd14b85
)

vcpkg_check_features(OUT_FEATURE_OPTIONS FEATURE_OPTIONS
    FEATURES
        tests MALWARE_DETECTOR_BUILD_TESTS
        examples MALWARE_DETECTOR_BUILD_EXAMPLES
)

vcpkg_cmake_configure(
    SOURCE_PATH ${SOURCE_PATH}
    OPTIONS
        -DMALWARE_DETECTOR_BUILD_EXAMPLES=OFF
        -DMALWARE_DETECTOR_BUILD_TESTS=OFF
        -DMALWARE_DETECTOR_INSTALL=ON
        ${FEATURE_OPTIONS}
)

vcpkg_cmake_install()

vcpkg_cmake_config_fixup(CONFIG_PATH lib/cmake/malware_detector)

# Fix pkgconfig
vcpkg_fixup_pkgconfig()

# Remove debug include directory
file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/include")

# Install usage file
file(INSTALL "${CMAKE_CURRENT_LIST_DIR}/usage" DESTINATION "${CURRENT_PACKAGES_DIR}/share/${PORT}")

file(INSTALL ${SOURCE_PATH}/LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/malware-detector RENAME copyright)
